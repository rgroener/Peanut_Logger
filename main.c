/*
 * Altitude logger for rubber powered models
 * 
 * grn Dec/20
 * 
 * avrdude: safemode: Fuses OK (E:F7, H:D9, L:62)
 * */
#define F_CPU 8000000UL// set the CPU clock
#include <util/delay.h>
#include <avr/interrupt.h>
#include <stdlib.h>
#include <avr/io.h>
#include <stdio.h>                 
#include <avr/pgmspace.h>

//OLED Controling
#define CS_DISP_0 	PORTB &= ~(1<<PB0)	//select chip select display
#define CS_DISP_1 	PORTB |= (1<<PB0)	//deselect chip select display
#define DISP_DATA	PORTB |= (1<<PB2)	//set D/C to data
#define DISP_COMM	PORTB &= ~(1<<PB2)	//set D/C to command
#define DISP_RST_0	PORTB &= ~(1<<PB1)	//set Reset to 0
#define DISP_RST_1	PORTB |= (1<<PB1)	//set Reset to 1

#define 	Start_column	0x00
#define 	Start_page		0x00
#define	StartLine_set	0x00

const unsigned char pic1[] PROGMEM = 
{ 
	/*64x48  --*/
0x00,0x00,0x00,0x00,0x00,0xC0,0x00,0xE0,0x00,0xF0,0x00,0xFC,0x00,0x00,0x00,0x00,
0x04,0x06,0x12,0x12,0xFE,0xEC,0x00,0xF8,0xFC,0x06,0x02,0x22,0xE6,0xE4,0x00,0x00,
0x00,0xF0,0x90,0x9C,0x04,0xF4,0x04,0xF4,0xF4,0x04,0xF4,0xF4,0x04,0x04,0xFC,0x00,
0x00,0x00,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x00,0x00,0x00,
0x01,0x03,0x02,0x02,0x03,0x01,0x00,0x00,0x01,0x03,0x02,0x02,0x03,0x01,0x00,0x00,
0x00,0x00,0x00,0x03,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x03,0x00,
0x00,0x00,0x0C,0x06,0xFF,0xFF,0x00,0x00,0x00,0x0C,0x06,0xFF,0xFF,0x00,0x00,0x00,
0x18,0x18,0x00,0xFE,0xFF,0x01,0x01,0xFF,0xFE,0x00,0x1C,0x1F,0x0B,0x09,0xF9,0xF1,
0x00,0xF8,0x48,0x48,0x78,0x00,0xF8,0x30,0xC0,0x00,0xC0,0x30,0xF8,0x00,0x00,0x00,
0x00,0x00,0xC0,0x20,0x23,0x23,0x20,0x40,0x00,0x00,0x80,0x83,0x83,0x00,0x80,0xE0,
0x83,0x03,0x80,0x01,0x03,0x02,0x82,0x03,0x81,0x00,0x81,0x03,0x02,0x82,0x83,0x01,
0xE0,0x03,0x00,0x80,0x80,0x80,0x03,0x00,0x81,0x02,0x01,0x00,0x83,0x00,0x00,0x00,
0x00,0x00,0x08,0x11,0x11,0x12,0x12,0x0C,0x00,0x0D,0x12,0x12,0x0A,0x1F,0x00,0x1F,
0x10,0x00,0x0F,0x10,0x10,0x08,0x1F,0x00,0x1F,0x01,0x00,0x00,0x0F,0x10,0x10,0x09,
0x1F,0x00,0x0D,0x12,0x12,0x0A,0x1F,0x00,0x01,0x46,0x38,0x06,0x01,0x00,0x00,0x00,
0xF8,0x04,0x04,0x04,0x88,0x00,0xFC,0x10,0x10,0xE0,0x00,0xF4,0x00,0xF0,0x10,0x10,
0xE0,0x00,0x90,0x50,0x50,0xF0,0x00,0xFC,0x18,0xE0,0x00,0xE0,0x18,0xFC,0xE0,0x10,
0x10,0xE0,0x00,0xFC,0x10,0x10,0xE0,0x00,0xF4,0x00,0xFC,0x00,0xE0,0x50,0x50,0x60,
0x00,0x01,0x01,0x01,0xC0,0x00,0x01,0x00,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x00,
0x01,0x00,0x81,0x41,0x41,0x41,0x80,0x01,0x00,0x00,0x81,0x40,0x40,0x41,0x80,0x01,
0x81,0x40,0x40,0x41,0x81,0x01,0x00,0x80,0xC1,0x00,0x81,0x40,0x40,0x41,0x81,0x01,
0x00,0x18,0x20,0x20,0x1F,0x00,0x1A,0x25,0x25,0x15,0x3E,0x00,0x3F,0x01,0x01,0x01,
0x3E,0x00,0x1D,0x22,0x22,0x22,0x1D,0x00,0x00,0x00,0x20,0x30,0x28,0x24,0x23,0x00,
0x1F,0x20,0x20,0x20,0x1F,0x00,0x01,0x00,0x3F,0x00,0x1D,0x22,0x22,0x22,0x1D,0x00,


};
const unsigned char pic[] PROGMEM = 
{/*64x48  --*/
0x00,0x00,0x00,0x00,0x00,0xC0,0x00,0xE0,0x00,0xF0,0x00,0xFC,0x00,0x00,0x00,0x00,
0x04,0x06,0x12,0x12,0xFE,0xEC,0x00,0xF8,0xFC,0x06,0x02,0x22,0xE6,0xE4,0x00,0x00,
0x00,0xF0,0x90,0x9C,0x04,0xF4,0x04,0xF4,0xF4,0x04,0xF4,0xF4,0x04,0x04,0xFC,0x00,
0x00,0x00,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x00,0x00,0x00,
0x01,0x03,0x02,0x02,0x03,0x01,0x00,0x00,0x01,0x03,0x02,0x02,0x03,0x01,0x00,0x00,
0x00,0x00,0x00,0x03,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x03,0x00,
0x00,0x00,0x0C,0x06,0xFF,0xFF,0x00,0x00,0x00,0x0C,0x06,0xFF,0xFF,0x00,0x00,0x00,
0x18,0x18,0x00,0xFE,0xFF,0x01,0x01,0xFF,0xFE,0x00,0x1C,0x1F,0x0B,0x09,0xF9,0xF1,
0x00,0xF8,0x48,0x48,0x78,0x00,0xF8,0x30,0xC0,0x00,0xC0,0x30,0xF8,0x00,0x00,0x00,
0x00,0x00,0xC0,0x20,0x23,0x23,0x20,0x40,0x00,0x00,0x80,0x83,0x83,0x00,0x80,0xE0,
0x83,0x03,0x80,0x01,0x03,0x02,0x82,0x03,0x81,0x00,0x81,0x03,0x02,0x82,0x83,0x01,
0xE0,0x03,0x00,0x80,0x80,0x80,0x03,0x00,0x81,0x02,0x01,0x00,0x83,0x00,0x00,0x00,
0x00,0x00,0x08,0x11,0x11,0x12,0x12,0x0C,0x00,0x0D,0x12,0x12,0x0A,0x1F,0x00,0x1F,
0x10,0x00,0x0F,0x10,0x10,0x08,0x1F,0x00,0x1F,0x01,0x00,0x00,0x0F,0x10,0x10,0x09,
0x1F,0x00,0x0D,0x12,0x12,0x0A,0x1F,0x00,0x01,0x46,0x38,0x06,0x01,0x00,0x00,0x00,
0xF8,0x04,0x04,0x04,0x88,0x00,0xFC,0x10,0x10,0xE0,0x00,0xF4,0x00,0xF0,0x10,0x10,
0xE0,0x00,0x90,0x50,0x50,0xF0,0x00,0xFC,0x18,0xE0,0x00,0xE0,0x18,0xFC,0xE0,0x10,
0x10,0xE0,0x00,0xFC,0x10,0x10,0xE0,0x00,0xF4,0x00,0xFC,0x00,0xE0,0x50,0x50,0x60,
0x00,0x01,0x01,0x01,0xC0,0x00,0x01,0x00,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x00,
0x01,0x00,0x81,0x41,0x41,0x41,0x80,0x01,0x00,0x00,0x81,0x40,0x40,0x41,0x80,0x01,
0x81,0x40,0x40,0x41,0x81,0x01,0x00,0x80,0xC1,0x00,0x81,0x40,0x40,0x41,0x81,0x01,
0x00,0x18,0x20,0x20,0x1F,0x00,0x1A,0x25,0x25,0x15,0x3E,0x00,0x3F,0x01,0x01,0x01,
0x3E,0x00,0x1D,0x22,0x22,0x22,0x1D,0x00,0x00,0x00,0x20,0x30,0x28,0x24,0x23,0x00,
0x1F,0x20,0x20,0x20,0x1F,0x00,0x01,0x00,0x3F,0x00,0x1D,0x22,0x22,0x22,0x1D,0x00,


};
const unsigned char numbers[] PROGMEM =
{/*--  ÎÄ×Ö:  0~9  --*/
	0x00,0xF8,0xFC,0x04,0x04,0xFC,0xF8,0x00,0x00,0x03,0x07,0x04,0x04,0x07,0x03,0x00,  	   
	0x00,0x00,0x08,0xFC,0xFC,0x00,0x00,0x00,0x00,0x00,0x04,0x07,0x07,0x04,0x00,0x00,  
	0x00,0x18,0x1C,0x84,0xC4,0x7C,0x38,0x00,0x00,0x06,0x07,0x05,0x04,0x04,0x04,0x00,
	0x00,0x08,0x0C,0x24,0x24,0xFC,0xD8,0x00,0x00,0x02,0x06,0x04,0x04,0x07,0x03,0x00,
	0x80,0xE0,0x70,0x18,0xFC,0xFC,0x00,0x00,0x00,0x01,0x01,0x05,0x07,0x07,0x04,0x00,
	0x00,0x7C,0x7C,0x24,0x24,0xE4,0xC4,0x00,0x00,0x03,0x07,0x04,0x04,0x07,0x03,0x00,
	0x00,0xF0,0xF8,0x6C,0x24,0xEC,0xCC,0x00,0x00,0x03,0x07,0x04,0x04,0x07,0x03,0x00,
	0x00,0x0C,0x0C,0xC4,0xFC,0x3C,0x04,0x00,0x00,0x00,0x00,0x07,0x07,0x00,0x00,0x00,
	0x00,0x98,0xFC,0x64,0x64,0xFC,0x98,0x00,0x00,0x03,0x07,0x04,0x04,0x07,0x03,0x00,
	0x00,0x78,0xFC,0x84,0xC4,0xFC,0xF8,0x00,0x00,0x06,0x06,0x04,0x06,0x03,0x01,0x00
};

/*
 * RES		PB1
 * CS_DISP	PB0
 * SCK		PB5
 * MISO		PB4
 * D/C		PB2
 * SDO		PD2
 * MOSI		PB3
 * SDA		PC4
 * SCL		PC5
 * 
 * */
void SPI_MasterInit(void);
void SPI_MasterTransmit(char cData);
void send_data(char data);
void send_command(char command);
void Set_Page_Address(unsigned char add);
void Set_Column_Address(unsigned char add);
void Set_Contrast_Control_Register(unsigned char mod);
void Display_Picture(const unsigned char pic[]);
void Display_Init(void);
void Display_Clear(void);
void Write_Char(char n);
const unsigned char font[] PROGMEM =
{	
	//8x14 MSB 
	0x00,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x00,0x10,0x10,0x00,0x00,0x00,	// 0x21
	0x24,0x24,0x24,0x24,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,	// 0x22
	0x00,0x09,0x09,0x12,0x7F,0x12,0x24,0xFF,0x24,0x48,0x48,0x00,0x00,0x00,	// 0x23
	0x10,0x3C,0x50,0x50,0x50,0x30,0x18,0x14,0x14,0x14,0x78,0x10,0x00,0x00,	// 0x24
	0x00,0x61,0x92,0x94,0x94,0x68,0x16,0x29,0x29,0x49,0x86,0x00,0x00,0x00,	// 0x25
	0x00,0x18,0x24,0x24,0x28,0x30,0xD1,0x89,0x8E,0xC6,0x7F,0x00,0x00,0x00,	// 0x26
	0x10,0x10,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,	// 0x27
	0x06,0x0C,0x10,0x10,0x20,0x20,0x20,0x20,0x20,0x10,0x10,0x0C,0x06,0x00,	// 0x28
	0x60,0x30,0x08,0x08,0x04,0x04,0x04,0x04,0x04,0x08,0x08,0x30,0x60,0x00,	// 0x29
	0x00,0x10,0x10,0x66,0x28,0x34,0x24,0x00,0x00,0x00,0x00,0x00,0x00,0x00,	// 0x2A
	0x00,0x00,0x00,0x00,0x10,0x10,0x10,0xFE,0x10,0x10,0x10,0x00,0x00,0x00,	// 0x2B
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x08,0x10,0x00,	// 0x2C
	0x00,0x00,0x00,0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,	// 0x2D
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,	// 0x2E
	0x02,0x04,0x04,0x04,0x08,0x08,0x18,0x10,0x10,0x20,0x20,0x20,0x40,0x00,	// 0x2F
	0x00,0x18,0x24,0x42,0x42,0x42,0x42,0x42,0x42,0x24,0x18,0x00,0x00,0x00,	// 0x30
	0x00,0x08,0x78,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x7F,0x00,0x00,0x00,	// 0x31
	0x00,0x78,0x04,0x04,0x04,0x08,0x08,0x10,0x20,0x40,0x7C,0x00,0x00,0x00,	// 0x32
	0x00,0x3C,0x02,0x02,0x02,0x1C,0x02,0x02,0x02,0x02,0x3C,0x00,0x00,0x00,	// 0x33
	0x00,0x04,0x0C,0x14,0x14,0x24,0x44,0x7E,0x04,0x04,0x04,0x00,0x00,0x00,	// 0x34
	0x00,0x3E,0x20,0x20,0x20,0x38,0x06,0x02,0x02,0x02,0x3C,0x00,0x00,0x00,	// 0x35
	0x00,0x1C,0x20,0x40,0x40,0x5C,0x62,0x42,0x42,0x22,0x1C,0x00,0x00,0x00,	// 0x36
	0x00,0x7E,0x02,0x04,0x04,0x08,0x10,0x10,0x10,0x20,0x20,0x00,0x00,0x00,	// 0x37
	0x00,0x3C,0x42,0x42,0x44,0x38,0x24,0x42,0x42,0x42,0x3C,0x00,0x00,0x00,	// 0x38
	0x00,0x38,0x44,0x42,0x42,0x46,0x3A,0x02,0x02,0x04,0x38,0x00,0x00,0x00,	// 0x39
	0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,	// 0x3A
	0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x18,0x18,0x08,0x10,0x00,	// 0x3B
	0x00,0x00,0x00,0x00,0x02,0x0C,0x10,0x60,0x10,0x0C,0x02,0x00,0x00,0x00,	// 0x3C
	0x00,0x00,0x00,0x00,0x00,0x7E,0x00,0x00,0x7E,0x00,0x00,0x00,0x00,0x00,	// 0x3D
	0x00,0x00,0x00,0x00,0x40,0x30,0x08,0x06,0x08,0x30,0x40,0x00,0x00,0x00,	// 0x3E
	0x00,0x7C,0x42,0x02,0x04,0x08,0x10,0x10,0x00,0x10,0x10,0x00,0x00,0x00,	// 0x3F
	0x00,0x3C,0x62,0x4E,0x92,0x92,0x92,0x96,0xDB,0x44,0x3C,0x00,0x00,0x00,	// 0x40
	0x00,0x00,0x08,0x18,0x14,0x24,0x24,0x42,0x7E,0x42,0x81,0x00,0x00,0x00,	// 0x41
	0x00,0x00,0x7C,0x42,0x42,0x44,0x78,0x44,0x42,0x42,0x7C,0x00,0x00,0x00,	// 0x42
	0x00,0x00,0x3E,0x40,0x80,0x80,0x80,0x80,0x80,0x40,0x3E,0x00,0x00,0x00,	// 0x43
	0x00,0x00,0xF8,0x84,0x82,0x82,0x82,0x82,0x82,0x84,0xF8,0x00,0x00,0x00,	// 0x44
	0x00,0x00,0x7E,0x40,0x40,0x40,0x7C,0x40,0x40,0x40,0x7E,0x00,0x00,0x00,	// 0x45
	0x00,0x00,0x7E,0x40,0x40,0x40,0x7C,0x40,0x40,0x40,0x40,0x00,0x00,0x00,	// 0x46
	0x00,0x00,0x3E,0x40,0x80,0x80,0x80,0x8E,0x82,0x42,0x3E,0x00,0x00,0x00,	// 0x47
	0x00,0x00,0x42,0x42,0x42,0x42,0x7E,0x42,0x42,0x42,0x42,0x00,0x00,0x00,	// 0x48
	0x00,0x00,0x7C,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x7C,0x00,0x00,0x00,	// 0x49
	0x00,0x00,0x3C,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x78,0x00,0x00,0x00,	// 0x4A
	0x00,0x00,0x42,0x44,0x48,0x50,0x60,0x50,0x48,0x44,0x42,0x00,0x00,0x00,	// 0x4B
	0x00,0x00,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x7E,0x00,0x00,0x00,	// 0x4C
	0x00,0x00,0xC6,0xC6,0xC6,0xAA,0xAA,0xAA,0x92,0x82,0x82,0x00,0x00,0x00,	// 0x4D
	0x00,0x00,0x42,0x62,0x62,0x52,0x52,0x4A,0x4A,0x46,0x42,0x00,0x00,0x00,	// 0x4E
	0x00,0x00,0x38,0x44,0x82,0x82,0x82,0x82,0x82,0x44,0x38,0x00,0x00,0x00,	// 0x4F
	0x00,0x00,0x7C,0x42,0x42,0x42,0x46,0x78,0x40,0x40,0x40,0x00,0x00,0x00,	// 0x50
	0x00,0x00,0x38,0x44,0x82,0x82,0x82,0x82,0x82,0x44,0x38,0x06,0x03,0x00,	// 0x51
	0x00,0x00,0x78,0x44,0x44,0x44,0x78,0x48,0x4C,0x44,0x42,0x00,0x00,0x00,	// 0x52
	0x00,0x00,0x3E,0x40,0x40,0x60,0x18,0x06,0x02,0x02,0x7C,0x00,0x00,0x00,	// 0x53
	0x00,0x00,0xFE,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x00,0x00,0x00,	// 0x54
	0x00,0x00,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x3C,0x00,0x00,0x00,	// 0x55
	0x00,0x00,0x81,0x42,0x42,0x44,0x24,0x28,0x28,0x10,0x10,0x00,0x00,0x00,	// 0x56
	0x00,0x00,0x81,0x81,0x93,0x9A,0x5A,0x5A,0x66,0x66,0x24,0x00,0x00,0x00,	// 0x57
	0x00,0x00,0x81,0x42,0x24,0x18,0x18,0x18,0x24,0x42,0x81,0x00,0x00,0x00,	// 0x58
	0x00,0x00,0x81,0x42,0x44,0x28,0x18,0x10,0x10,0x10,0x10,0x00,0x00,0x00,	// 0x59
	0x00,0x00,0xFE,0x02,0x04,0x08,0x10,0x20,0x40,0x80,0xFE,0x00,0x00,0x00,	// 0x5A
	0x1E,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x1E,0x00,	// 0x5B
	0x40,0x20,0x20,0x20,0x10,0x10,0x18,0x08,0x08,0x04,0x04,0x04,0x02,0x00,	// 0x5C
	0x78,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x78,0x00,	// 0x5D
	0x00,0x08,0x08,0x18,0x14,0x14,0x24,0x22,0x42,0x00,0x00,0x00,0x00,0x00,	// 0x5E
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,	// 0x5F
	0x08,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,	// 0x60
	0x00,0x00,0x00,0x00,0x3C,0x02,0x02,0x3E,0x42,0x42,0x3F,0x00,0x00,0x00,	// 0x61
	0x40,0x40,0x40,0x40,0x5C,0x62,0x42,0x42,0x42,0x62,0x5C,0x00,0x00,0x00,	// 0x62
	0x00,0x00,0x00,0x00,0x1E,0x20,0x40,0x40,0x40,0x20,0x1E,0x00,0x00,0x00,	// 0x63
	0x02,0x02,0x02,0x02,0x3A,0x46,0x42,0x42,0x42,0x46,0x3A,0x00,0x00,0x00,	// 0x64
	0x00,0x00,0x00,0x00,0x3C,0x22,0x42,0x7E,0x40,0x40,0x3E,0x00,0x00,0x00,	// 0x65
	0x0E,0x10,0x10,0x10,0x7E,0x10,0x10,0x10,0x10,0x10,0x10,0x00,0x00,0x00,	// 0x66
	0x00,0x00,0x00,0x00,0x3E,0x46,0x42,0x42,0x42,0x46,0x3A,0x02,0x02,0x3C,	// 0x67
	0x40,0x40,0x40,0x40,0x5C,0x62,0x42,0x42,0x42,0x42,0x42,0x00,0x00,0x00,	// 0x68
	0x18,0x18,0x00,0x00,0x78,0x08,0x08,0x08,0x08,0x08,0x08,0x00,0x00,0x00,	// 0x69
	0x0C,0x0C,0x00,0x00,0x3C,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x78,	// 0x6A
	0x40,0x40,0x40,0x40,0x44,0x48,0x50,0x60,0x58,0x44,0x42,0x00,0x00,0x00,	// 0x6B
	0x78,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x00,0x00,0x00,	// 0x6C
	0x00,0x00,0x00,0x00,0xB6,0xDA,0x92,0x92,0x92,0x92,0x92,0x00,0x00,0x00,	// 0x6D
	0x00,0x00,0x00,0x00,0x5C,0x62,0x42,0x42,0x42,0x42,0x42,0x00,0x00,0x00,	// 0x6E
	0x00,0x00,0x00,0x00,0x38,0x44,0x82,0x82,0x82,0x44,0x38,0x00,0x00,0x00,	// 0x6F
	0x00,0x00,0x00,0x00,0x5C,0x62,0x42,0x42,0x42,0x62,0x5C,0x40,0x40,0x40,	// 0x70
	0x00,0x00,0x00,0x00,0x3A,0x46,0x42,0x42,0x42,0x46,0x3A,0x02,0x02,0x02,	// 0x71
	0x00,0x00,0x00,0x00,0x5C,0x64,0x40,0x40,0x40,0x40,0x40,0x00,0x00,0x00,	// 0x72
	0x00,0x00,0x00,0x00,0x3C,0x40,0x60,0x18,0x04,0x04,0x78,0x00,0x00,0x00,	// 0x73
	0x00,0x00,0x20,0x20,0xFE,0x20,0x20,0x20,0x20,0x20,0x1E,0x00,0x00,0x00,	// 0x74
	0x00,0x00,0x00,0x00,0x42,0x42,0x42,0x42,0x42,0x46,0x3A,0x00,0x00,0x00,	// 0x75
	0x00,0x00,0x00,0x00,0x81,0x42,0x42,0x44,0x28,0x28,0x10,0x00,0x00,0x00,	// 0x76
	0x00,0x00,0x00,0x00,0x81,0x89,0x5A,0x5A,0x66,0x24,0x24,0x00,0x00,0x00,	// 0x77
	0x00,0x00,0x00,0x00,0x42,0x24,0x18,0x18,0x18,0x24,0x42,0x00,0x00,0x00,	// 0x78
	0x00,0x00,0x00,0x00,0x81,0x42,0x42,0x24,0x24,0x18,0x18,0x10,0x30,0xE0,	// 0x79
	0x00,0x00,0x00,0x00,0xFE,0x04,0x08,0x10,0x20,0x40,0xFE,0x00,0x00,0x00,	// 0x7A
};
void Char_Position(uint8_t row, uint8_t pos);
void Write_Char(char n);

int main(void)
{
	DDRB 	|= (1<<PB0) | (1<<PB1) | (1<<PB2) | (1<<PB3) | (1<<PB5);//set CS_DISP and RES and D/C output
	PORTB	|= (1<<PB0) | (1<<PB1) | (1<<PB2) | (1<<PB3) | (1<<PB5);//set CS_DISP and RES and D/C high
		
	DDRC |= (1<<PC5);	//SCL
	PORTC |= (1<<PC5);
	PORTC &= ~(1<<PC5);
	
	//init SPI as master without interrupt
	SPI_MasterInit();
    // Enable Global Interrupts
    //sei();
		
	Display_Init();
	Display_Clear();
	Set_Page_Address(0);
    Set_Column_Address(0);
  
	Char_Position(2,4);
	Write_Char('R');
	
	
	while(1)
	{ 		
		
	} //end while
}//end of main


void SPI_MasterInit(void)
{
	/* Set MOSI and SCK output, all others input */
	//DDRB = (1<<MOSI)|(1<<SCK);
	/* Enable SPI, Master, set clock rate fck/16 */
	SPCR0 = (1<<SPE)|(1<<MSTR)|(1<<SPR0);
}
void SPI_MasterTransmit(char cData)
{
	/* Start transmission */
	SPDR0 = cData;
	/* Wait for transmission complete */
	while(!(SPSR0 & (1<<SPIF)));
}
void send_data(char data)
{
	DISP_DATA;
	CS_DISP_0;
	SPI_MasterTransmit(data);
	CS_DISP_1;
}
void send_command(char command)
{
	DISP_COMM;
	CS_DISP_0;
	SPI_MasterTransmit(command);
	CS_DISP_1;
}
// Set page address 0~7
void Set_Page_Address(unsigned char add)
{
    add=0xb0|add;
    send_command(add);
	return;
}
void Set_Column_Address(unsigned char add)
{	 add+=40;
    send_command((0x10|(add>>4)));
	send_command((0x0f&add));
	return;
}
void Set_Contrast_Control_Register(unsigned char mod)
{
    send_command(0x81);
	send_command(mod);
	return;
}
void Display_Picture(const unsigned char pic[])
{
	//Display picture 48x64
    unsigned char i,j;
	for(i=0;i<0x08;i++)
	{
	Set_Page_Address(i);
    Set_Column_Address(0x00);
        for(j=0;j<0x30;j++)
		{
		    send_data(pgm_read_byte(&pic[i*0x30+j]));
		}
	}
    return;
}
void Display_Clear(void)
{
	//clear whole display
	unsigned char i,j;
	for(i=0;i<0x08;i++)
	{
	Set_Page_Address(i);
    Set_Column_Address(0x00);
        for(j=0;j<0x30;j++)
		{
		    send_data(0x00);
		}
	}
    return;
}
void Char_Position(uint8_t row, uint8_t pos)
{
	//set position for new char (font size 8x14)
	Set_Page_Address(7-pos);	//0-7 	(* 8 bit)
	Set_Column_Address(row*14);	//0-3	(* 14 collums / char)
}
void Write_Char(char n)
{
	// writes char at current cursor position
	
	uint8_t x;
	n-=0x21;	//jump to position in asci table
	
	for(x=0;x<14;x++) //print char
	{
			send_data(pgm_read_byte(&font[(n*14)+x]));
	}
}
void Display_Init(void)
{
	/*Init session according datasheet and sample code:
	 *https://www.buydisplay.com/serial-spi-0-71-inch-white-48x64-graphic-oled-display-ssd1306
	 * */
	DISP_RST_1;
	_delay_ms(10);
	DISP_RST_0;
	_delay_ms(20);
	DISP_RST_1;
	_delay_ms(10);
	DISP_COMM;
	CS_DISP_0;		
	send_command(0xae);//--turn off oled panel
	send_command(0xd5);//--set display clock divide ratio/oscillator frequency
	send_command(0x80);//--set divide ratio
	send_command(0xa8);//--set multiplex ratio(1 to 64)
	send_command(0x3f);//--1/64 duty orig 3f
	send_command(0xd3);//-set display offset
	send_command(0x00);//-not offset
	send_command(0x8d);//--set Charge Pump enable/disable
	send_command(0x14);//--set(0x10) disable
	send_command(0xa6);//--set normal display
	send_command(0xa4);// Disable Entire Display On orig a4
	send_command(0xa1);//--set segment re-map 128 to 0
	send_command(0xC8);//--Set COM Output Scan Direction 64 to 0
	send_command(0xda);//--set com pins hardware configuration
	send_command(0x12);
	send_command(0x81);//--set contrast control register
	send_command(0x01);//orig 80
	send_command(0xd9);//--set pre-charge period
	send_command(0xf1);
	send_command(0xdb);//--set vcomh
	send_command(0x40);//--set start line address orig 40
	send_command(0xaf);//--turn on oled panel
	CS_DISP_1;		   //release chip select
	DISP_DATA;
}
